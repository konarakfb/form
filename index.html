<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dry Store Stock Record</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding: 20px;
    }
    .container {
        max-width: 1100px;
        margin: auto;
        background: white;
        padding: 20px;
        border: 1px solid #000;
    }
    h2 {
        text-align: center;
        font-size: 22px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    th, td {
        border: 1px solid #000;
        padding: 6px;
        text-align: center;
    }
    input {
        width: 100%;
        padding: 4px;
        border: none;
        outline: none;
        text-align: center;
    }
    .btn-box {
        margin-top: 15px;
        display: flex;
        gap: 10px;
    }
    button {
        padding: 10px 15px;
        border: none;
        cursor: pointer;
        font-size: 15px;
        border-radius: 5px;
    }
    .add { background: #007bff; color: white; }
    .save { background: #28a745; color: white; }
    .reset { background: #dc3545; color: white; }
    .download { background: #6f42c1; color: white; }
</style>
</head>

<body>

<div class="container">

    <h2>Dry Store Stock Record</h2>

    <!-- Top Info -->
    <table>
        <tr>
            <td>Date: <input id="date"></td>
            <td>Vendor Name: <input id="vendor"></td>
            <td>Vendor Supervisor: <input id="supervisor"></td>
        </tr>
    </table>

    <!-- Main Table -->
    <table id="stockTable">
        <thead>
            <tr>
                <th>S.No</th>
                <th>Item</th>
                <th>Batch No</th>
                <th>Receiving Date</th>
                <th>Mfg Date</th>
                <th>Expiry</th>
                <th>Shelf Life</th>
                <th>Stock Qty</th>
                <th>Remarks</th>
            </tr>
        </thead>
        <tbody id="tableBody">
        </tbody>
    </table>

    <!-- Buttons -->
    <div class="btn-box">
        <button class="add" onclick="addRow()">Add Row</button>
        <button class="save" onclick="saveData()">Save</button>
        <button class="download" onclick="downloadData()">Download</button>
        <button class="reset" onclick="resetData()">Reset</button>
    </div>

</div>

<script>
/* ----------------------
   ADD ROW
---------------------- */
function addRow() {
    const tbody = document.getElementById("tableBody");
    const rowCount = tbody.rows.length + 1;

    const row = `
    <tr>
        <td>${rowCount}</td>
        <td><input></td>
        <td><input></td>
        <td><input type="date"></td>
        <td><input type="date"></td>
        <td><input type="date"></td>
        <td><input></td>
        <td><input></td>
        <td><input></td>
    </tr>`;

    tbody.insertAdjacentHTML('beforeend', row);
}

/* ----------------------
   SAVE DATA (LOCK FIELDS)
---------------------- */
function saveData() {
    let data = {
        date: document.getElementById("date").value,
        vendor: document.getElementById("vendor").value,
        supervisor: document.getElementById("supervisor").value,
        records: []
    };

    const rows = document.querySelectorAll("#tableBody tr");

    rows.forEach(row => {
        let cells = row.querySelectorAll("td input");
        data.records.push({
            item: cells[0].value,
            batch: cells[1].value,
            receiving: cells[2].value,
            mfg: cells[3].value,
            expiry: cells[4].value,
            shelfLife: cells[5].value,
            qty: cells[6].value,
            remarks: cells[7].value
        });
    });

    // Save to localStorage
    localStorage.setItem("dryStoreRecord", JSON.stringify(data));

    // Lock form
    document.querySelectorAll("input").forEach(i => i.disabled = true);

    alert("Data Saved & Locked!");
}

/* ----------------------
   RESET DATA
---------------------- */
function resetData() {
    if (!confirm("Clear all data?")) return;

    localStorage.removeItem("dryStoreRecord");

    // Reload page to clear everything
    location.reload();
}

/* ----------------------
   DOWNLOAD JSON DATA
---------------------- */
function downloadData() {
    const saved = localStorage.getItem("dryStoreRecord");
    if (!saved) return alert("No saved data!");

    const blob = new Blob([saved], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "Dry_Store_Record.json";
    a.click();

    URL.revokeObjectURL(url);
}

/* ----------------------
   LOAD LAST SAVED DATA
---------------------- */
window.onload = function () {
    const saved = localStorage.getItem("dryStoreRecord");
    if (!saved) {
        addRow();
        addRow();
        return;
    }

    const data = JSON.parse(saved);

    document.getElementById("date").value = data.date;
    document.getElementById("vendor").value = data.vendor;
    document.getElementById("supervisor").value = data.supervisor;

    data.records.forEach((rec, i) => {
        addRow();
        const inputs = document.querySelectorAll(`#tableBody tr:nth-child(${i+1}) td input`);

        inputs[0].value = rec.item;
        inputs[1].value = rec.batch;
        inputs[2].value = rec.receiving;
        inputs[3].value = rec.mfg;
        inputs[4].value = rec.expiry;
        inputs[5].value = rec.shelfLife;
        inputs[6].value = rec.qty;
        inputs[7].value = rec.remarks;
    });

    // Lock again if previously saved
    document.querySelectorAll("input").forEach(i => i.disabled = true);
};
</script>

</body>
</html>
